#!/usr/bin/env php
<?php
if (PHP_SAPI !== 'cli') {
	echo 'Warning: Plista Releaser should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;
}

require __DIR__.'/../src/bootstrap.php';

use Plista\Chimney\Console\Application;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\DependencyInjection\Reference;
use Plista\Chimney\Command;
use Plista\Chimney\System\CommandExecutor;
use Plista\Chimney\System\GitCommand;
use Plista\Chimney\Console\PlaceholderManagerService;

if (function_exists('ini_set')) {
	@ini_set('display_errors', 1);
}

$container = new ContainerBuilder();
$container->register(Command\ContainerAwareCommand::SERVICE_COMMAND_EXE, CommandExecutor::class);
$container->register(Command\ContainerAwareCommand::SERVICE_GIT_COMMAND, GitCommand::class)
    ->addArgument(new Reference(Command\ContainerAwareCommand::SERVICE_COMMAND_EXE));
$container->register(Command\ContainerAwareCommand::SERVICE_PLACEHOLDER_MANAGER, PlaceholderManagerService::class);

// run the command application
$application = new Application();
$application->addCommands([
	new Command\AboutCommand(),
	new Command\MakeCommand($container),
    new Command\VersionCommand($container),
    new Command\FetchCommand($container)
]);
$application->run();